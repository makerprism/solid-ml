// Generated by Melange

import * as Caml_format from "melange.js/caml_format.js";
import * as Caml_option from "melange.js/caml_option.js";
import * as Curry from "melange.js/curry.js";
import * as Solid_ml_browser__Dom from "solid-ml-browser/dom.js";
import * as Solid_ml_browser__Reactive from "solid-ml-browser/reactive.js";
import * as Solid_ml_browser__Reactive_core from "solid-ml-browser/reactive_core.js";

function get_element(id) {
  return Solid_ml_browser__Dom.get_element_by_id(Solid_ml_browser__Dom.$$document, id);
}

function read_initial(param) {
  const hidden = Solid_ml_browser__Dom.get_element_by_id(Solid_ml_browser__Dom.$$document, "counter-initial");
  if (hidden === undefined) {
    return 0;
  }
  const value = Solid_ml_browser__Dom.get_attribute(Caml_option.valFromOption(hidden), "value");
  if (value === undefined) {
    return 0;
  }
  try {
    return Caml_format.caml_int_of_string(value);
  }
  catch (exn){
    return 0;
  }
}

Solid_ml_browser__Reactive_core.create_root(function (param) {
  const counter_el = Solid_ml_browser__Dom.get_element_by_id(Solid_ml_browser__Dom.$$document, "counter-value");
  if (counter_el === undefined) {
    return Solid_ml_browser__Dom.warn("#counter-value not found; nothing to hydrate");
  }
  const counter_el$1 = Caml_option.valFromOption(counter_el);
  const initial = read_initial(undefined);
  const match = Solid_ml_browser__Reactive.Signal.create(undefined, initial);
  const set_count = match[1];
  const count = match[0];
  const svg_text = Solid_ml_browser__Dom.query_selector(Solid_ml_browser__Dom.$$document, "svg text");
  Curry._1(Solid_ml_browser__Reactive.Effect.create, (function (param) {
    const value = Curry._1(Solid_ml_browser__Reactive.Signal.get, count);
    Solid_ml_browser__Dom.set_inner_html(counter_el$1, String(value));
    if (svg_text !== undefined) {
      return Solid_ml_browser__Dom.set_inner_html(Caml_option.valFromOption(svg_text), "solid-ml " + String(value));
    }
    
  }));
  const attach = function (id, action) {
    const button = Solid_ml_browser__Dom.get_element_by_id(Solid_ml_browser__Dom.$$document, id);
    if (button !== undefined) {
      return Solid_ml_browser__Dom.add_event_listener(Caml_option.valFromOption(button), "click", (function (param) {
        Curry._1(action, undefined);
      }));
    }
    
  };
  attach("increment", (function (param) {
    Solid_ml_browser__Reactive.Signal.update(count, (function (n) {
      return n + 1 | 0;
    }));
  }));
  attach("decrement", (function (param) {
    Solid_ml_browser__Reactive.Signal.update(count, (function (n) {
      return n - 1 | 0;
    }));
  }));
  attach("reset", (function (param) {
    Curry._1(set_count, initial);
  }));
  const el = Solid_ml_browser__Dom.get_element_by_id(Solid_ml_browser__Dom.$$document, "hydration-status");
  if (el !== undefined) {
    Solid_ml_browser__Dom.set_inner_html(Caml_option.valFromOption(el), "Hydrated! Try the buttons.");
  }
  Solid_ml_browser__Dom.log("solid-ml counter hydrated");
});

export {
  get_element,
  read_initial,
}
/*  Not a pure module */
