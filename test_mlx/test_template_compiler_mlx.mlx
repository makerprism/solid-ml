open Solid_ml

module Hello (Env : Solid_ml_template_runtime.Env_intf.TEMPLATE_ENV) = struct
  open Env

  module Html = Env.Html

  let render_div ~name () =
    <Html.div>
      (Solid_ml_template_runtime.Tpl.text (fun () -> Signal.get name))
    </Html.div>

  let render_span ~name () =
    <Html.span>
      (Solid_ml_template_runtime.Tpl.text (fun () -> Signal.get name))
    </Html.span>

  let render_p ~name () =
    <Html.p>
      (Solid_ml_template_runtime.Tpl.text (fun () -> Signal.get name))
    </Html.p>

  let render_p_static ~name () =
    <Html.p>
      (Html.text "Hello ")
      (Solid_ml_template_runtime.Tpl.text (fun () -> Signal.get name))
      (Html.text "!")
    </Html.p>

  let render_p_formatting ~name () =
    <Html.p>
      (Html.text "\n  ")
      (Html.text "Hello ")
      (Solid_ml_template_runtime.Tpl.text (fun () -> Signal.get name))
      (Html.text "!")
      (Html.text "\n")
    </Html.p>

  let render_p_space ~name () =
    <Html.p>
      (Html.text " ")
      (Solid_ml_template_runtime.Tpl.text (fun () -> Signal.get name))
    </Html.p>

  let render_p_double_space ~name () =
    <Html.p>
      (Html.text "  ")
      (Solid_ml_template_runtime.Tpl.text (fun () -> Signal.get name))
    </Html.p>

  let render_p_tab_formatting ~name () =
    <Html.p>
      (Html.text "\t")
      (Html.text "Hello ")
      (Solid_ml_template_runtime.Tpl.text (fun () -> Signal.get name))
    </Html.p>

  let render_pre_formatting ~name () =
    <Html.pre>
      (Html.text "\n  ")
      (Solid_ml_template_runtime.Tpl.text (fun () -> Signal.get name))
      (Html.text "\n")
    </Html.pre>

  let render_code_formatting ~name () =
    <Html.code>
      (Html.text "\n  ")
      (Solid_ml_template_runtime.Tpl.text (fun () -> Signal.get name))
      (Html.text "\n")
    </Html.code>

  let render_p_two_slots ~first ~last () =
    <Html.p>
      (Html.text "Hello ")
      (Solid_ml_template_runtime.Tpl.text (fun () -> Signal.get first))
      (Html.text ", ")
      (Solid_ml_template_runtime.Tpl.text (fun () -> Signal.get last))
      (Html.text "!")
    </Html.p>
end

let () =
  print_endline "Test: Template PPX compiles Tpl.text (MLX)";
  let name, _set_name = Signal.create "World" in
  let html =
    Solid_ml_ssr.Render.to_string (fun () ->
      let module C = Hello (Solid_ml_ssr.Env) in
      C.render_div ~name ())
  in
  assert (html = "<div>World</div>");

  let html_span =
    Solid_ml_ssr.Render.to_string (fun () ->
      let module C = Hello (Solid_ml_ssr.Env) in
      C.render_span ~name ())
  in
  assert (html_span = "<span>World</span>");

  let html_p =
    Solid_ml_ssr.Render.to_string (fun () ->
      let module C = Hello (Solid_ml_ssr.Env) in
      C.render_p ~name ())
  in
  assert (html_p = "<p>World</p>");

  let html_p_static =
    Solid_ml_ssr.Render.to_string (fun () ->
      let module C = Hello (Solid_ml_ssr.Env) in
      C.render_p_static ~name ())
  in
  assert (html_p_static = "<p>Hello World!</p>");

  let html_p_formatting =
    Solid_ml_ssr.Render.to_string (fun () ->
      let module C = Hello (Solid_ml_ssr.Env) in
      C.render_p_formatting ~name ())
  in
  assert (html_p_formatting = "<p>Hello World!</p>");

  let html_p_space =
    Solid_ml_ssr.Render.to_string (fun () ->
      let module C = Hello (Solid_ml_ssr.Env) in
      C.render_p_space ~name ())
  in
  assert (html_p_space = "<p> World</p>");

  let html_p_double_space =
    Solid_ml_ssr.Render.to_string (fun () ->
      let module C = Hello (Solid_ml_ssr.Env) in
      C.render_p_double_space ~name ())
  in
  assert (html_p_double_space = "<p>  World</p>");

  let html_p_tab_formatting =
    Solid_ml_ssr.Render.to_string (fun () ->
      let module C = Hello (Solid_ml_ssr.Env) in
      C.render_p_tab_formatting ~name ())
  in
  assert (html_p_tab_formatting = "<p>Hello World</p>");

  let html_pre_formatting =
    Solid_ml_ssr.Render.to_string (fun () ->
      let module C = Hello (Solid_ml_ssr.Env) in
      C.render_pre_formatting ~name ())
  in
  assert (html_pre_formatting = "<pre>\n  World\n</pre>");

  let html_code_formatting =
    Solid_ml_ssr.Render.to_string (fun () ->
      let module C = Hello (Solid_ml_ssr.Env) in
      C.render_code_formatting ~name ())
  in
  assert (html_code_formatting = "<code>\n  World\n</code>");

  let first, _set_first = Signal.create "Ada" in
  let last, _set_last = Signal.create "Lovelace" in
  let html_p_two =
    Solid_ml_ssr.Render.to_string (fun () ->
      let module C = Hello (Solid_ml_ssr.Env) in
      C.render_p_two_slots ~first ~last ())
  in
  assert (html_p_two = "<p>Hello Ada, Lovelace!</p>");

  print_endline "  PASSED"
