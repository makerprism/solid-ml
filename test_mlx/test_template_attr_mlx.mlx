open Solid_ml

module C (Env : Solid_ml_template_runtime.Env_intf.TEMPLATE_ENV) = struct
  open Env

  module Html = Env.Html

  let render_a_some ~name () =
    <Html.a href=(Solid_ml_template_runtime.Tpl.attr_opt ~name:"href" (fun () -> Some "/x?y=<z>"))>
      (Html.text "Go ")
      (Solid_ml_template_runtime.Tpl.text (fun () -> Signal.get name))
    </Html.a>

  let render_a_none ~name () =
    <Html.a href=(Solid_ml_template_runtime.Tpl.attr_opt ~name:"href" (fun () -> None))>
      (Html.text "Go ")
      (Solid_ml_template_runtime.Tpl.text (fun () -> Signal.get name))
    </Html.a>
end

let () =
  print_endline "Test: Template PPX compiles Tpl.attr_opt (MLX)";
  let name, _set_name = Signal.create "World" in

  let some_html =
    Solid_ml_ssr.Render.to_string (fun () ->
      let module R = C (Solid_ml_ssr.Env) in
      R.render_a_some ~name ())
  in
  assert (some_html = "<a href=\"/x?y=&lt;z&gt;\">Go World</a>");

  let none_html =
    Solid_ml_ssr.Render.to_string (fun () ->
      let module R = C (Solid_ml_ssr.Env) in
      R.render_a_none ~name ())
  in
  assert (none_html = "<a>Go World</a>");

  print_endline "  PASSED"
